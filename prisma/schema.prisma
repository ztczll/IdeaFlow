// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  name          String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // 团队关系
  teams         TeamMember[]
  ownedTeams    Team[]    @relation("TeamOwner")
  
  // 需求
  requirements  Requirement[]
}

model Team {
  id            String    @id @default(cuid())
  name          String
  ownerId       String
  owner         User      @relation("TeamOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  createdAt     DateTime  @default(now())
  
  members       TeamMember[]
  requirements  Requirement[]
}

model TeamMember {
  id        String   @id @default(cuid())
  userId    String
  teamId    String
  role      String   @default("member") // owner, admin, member
  joinedAt  DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  team      Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  
  @@unique([userId, teamId])
  @@index([userId])
  @@index([teamId])
}

model Requirement {
  id                  String   @id @default(cuid())
  requirementId       String   @unique // AI-001格式
  entryDate           DateTime @default(now())
  description         String   @db.VarChar(140)
  problem             String?  @db.Text
  businessValue       String?  @db.Text
  associatedUsers     String[] // 多选角色
  dataSources         String?  @db.Text
  feasibility         String?  // 高/中/低
  inspiration         String?  @db.VarChar(140)
  status              String   @default("收集")
  nextAction          String?  @db.VarChar(140)
  verificationResult  String?  @db.Text
  projectNumber       String?
  completedDate       DateTime?
  
  // 关联
  userId              String
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  teamId              String?
  team                Team?    @relation(fields: [teamId], references: [id], onDelete: SetNull)
  
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  @@index([userId, status])
  @@index([teamId, status])
  @@index([entryDate])
  @@index([status])
}

